{"name":"Disruptor Illustrated","tagline":"","body":"# technology is similar, thought behind is the key\r\n\r\nso we start from the real world examples, we will find the idea behind technology is counterpart of real world cases.\r\n\r\n# queue problem\r\n## real world\r\nconsider the basic queue processing, a lot of people need to buy their meals. as the boss of fast food, what are you supposed to do to serve more customers? imagine you employ only one waitress, so only one queue process all request. in order to improve throughput, the waitress must have fast hands. this is called scale up\r\n\r\n![Fasthand](images/fasthand.png)\r\n\r\nhowever the speed of waitress has a limit, if you can not hire a waitress with faster hand, what would you do? yes! hire another waitress, so the two waitress can process request parallel, and the total throughput is doubled. this is called scale out\r\n\r\n![Morewaitress](images/morewaitress.png)\r\n\r\n## technology world \r\nwhat is the technology counterpart? Parallel programming. when the cpu processor speed can increase, only one core is needed, and all the request is processed serial, the processor speed increase results in throughput and latency improvement. but now the cpu speed can not increase any more over 3GHZ, so more cores are introduced, and parallel programming is a must. the cpu speed no longer obey moore law, but the core numbers still obey.\r\n\r\n![Moore svg](Moore.svg)\r\n\r\n# staged\r\n\r\n## real world\r\nYour fast food is now grows rapidly, so you must extend your business to multiple cities, even multiple counties, so how request are processed? Again all the fast food is processing request in parallel, how ever as the boss you still need manage all the employees. but you can not manage all of them by yourself, so you hire managers to manager part of employers, and let them report to you. an organization layer forms. in this organization, there is multiple stages, any stage is responsible to process requests and then pass batch results to up stage. \r\n\r\n![Organization charts](organization.png)\r\n\r\n## technology world\r\n\r\nA program is split into multiple stages, and every stage compute in parallel. by increase number of processors, the compute is speed up. \r\n\r\n# speedup\r\n\r\ncan we speed up all the time? In real world there is all kind of inefficiency. one department must depend on another. How can we optimize process? here comes the Amdahl's law.\r\n\r\n**Amdahl's law**\r\n\r\nThe speedup of a program using multiple processors in parallel computing is limited by the time needed for the sequential fraction of the program. if %5 of the program cannot compute in parallel, the speedup can only reach 20 times no matter how many processors there are. \r\n\r\n![Amdahl law](amdahl.png)\r\n\r\n# optimization\r\nfind the bottleneck cant not parallel.\r\n\r\n## real world\r\n\r\nmanager collect requests from employee, they do not send every request to you, instead they wait until 100 requests, after preprocess it, batch send to you.\r\n\r\n## disruptor\r\n\r\nModern CPU has multiple level caches, since access main memory is expensive, the cache batch read data from main memory. Cache miss result in main memory access. \r\n\r\nDisruptor use ring buffer to place objects pad together in memory so as to avoid false sharing and cache miss.\r\n\r\n![cpu cache](cpu cache.png)\r\n\r\n![ringbuffer](ringbuffer.png)\r\n\r\n## real world\r\n\r\nstaff manager and quality manager both manage employee. they can exchange status of employee directly since their offices are close to each other.\r\n\r\n## disruptor\r\n\r\nsynchronization for shared resource is expensive. \r\n\r\n1. Lock: involves context switch, which is quite expensive.\r\n1. CAS: lock instruction pipeline and complex to program.\r\n\r\n![Lock penalty](lockpenalty.png)\r\n\r\n### Lock free\r\n\r\nTwo cores in CPU talk to each other directly via memory barriar to exchange resource state. \r\n\r\n![Memory barriar](memory barriar.png)\r\n\r\n# effect of disruptor","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}